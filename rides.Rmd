---
title: "Blue Bikes - Exploratory Data Analysis"
author: "Nathan David Obeng-Amoako"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r}
# Load necessary libraries without messages
suppressPackageStartupMessages({
  library(tidyverse)
  library(knitr)
  library(ggplot2)
  library(dplyr)
  library(scales)
})
```

```{r}
# Folder path on local drive
folder_path <- "C:/Users/natda/OneDrive/Desktop/Everything/Academics/PhD_NU/FALL 2024/IE 6200/R/blue_bikes/trip_data/"

# Get all CSV files in the folder
csv_files <- list.files(path = folder_path, pattern = "*.csv", full.names = TRUE)

# Initialize an empty list to store data frames
dfs <- list()

# Loop over each file, load it, rename columns, and append to the list
for (file in csv_files) {
  df <- read_csv(file, show_col_types = FALSE)  # Suppress column type messages
  
  # Rename the columns
  df <- df %>%
    rename(
      rider_type = member_casual,
      bike_type = rideable_type
    )
  
  # Append to the list of data frames
  dfs[[length(dfs) + 1]] <- df
}

# Combine all data frames into one
all_df <- bind_rows(dfs)

# Sort the combined data frame by "started_at" column
all_df <- all_df %>%
  arrange(started_at)

# Show the first few rows of the combined data frame
head(all_df)
```
```{r}
# Get the dimensions of all_df
dimensions <- dim(all_df)
cat("Number of rows:", dimensions[1], "\n")
cat("Number of columns:", dimensions[2], "\n")
```
```{r}
# Create a copy of all_df
combined_df <- all_df
```

```{r}
# Get the data types of the columns in combined_df
column_types <- sapply(combined_df, class)

# Display the column types
print(column_types)
```

```{r}
# Convert the datetime columns to character strings and check for fractional seconds
fractional_seconds <- combined_df %>%
  filter(grepl("\\.\\d+", as.character(started_at)) | grepl("\\.\\d+", as.character(ended_at)))

# Check if any rows with fractional seconds were found
if (nrow(fractional_seconds) == 0) {
  cat("No rows with fractional seconds found.\n")
} else {
  print(head(fractional_seconds[, c("started_at", "ended_at")]))
}
```

```{r}
# Check for missing values in each column of combined_df
missing_values <- sapply(combined_df, function(x) sum(is.na(x)))

# Display the missing values count for each column
print(missing_values)
```

```{r}
# Remove rows with any missing values in combined_df
combined_df <- na.omit(combined_df)
```

```{r}
# Check for missing values again after removing rows with NAs
missing_values_after <- sapply(combined_df, function(x) sum(is.na(x)))

# Display the missing values count for each column
print(missing_values_after)
```

```{r}
# Create a data frame from the sorted table of station counts
station_counts <- as.data.frame(sort(table(combined_df$start_station_name), decreasing = TRUE))

# Rename columns for clarity
colnames(station_counts) <- c("Station", "Count")

# Extract the top 5 most popular stations
most_popular_stations <- head(station_counts, 5)

# Extract the bottom 5 least popular stations
least_popular_stations <- tail(station_counts, 5)

# Combine the most and least popular stations into one data frame for display
combined_stations <- rbind(most_popular_stations, least_popular_stations)

# Display the combined data frame
print(combined_stations)
```

```{r}
validate_station_mappings <- function(dataframe) {
  # Create lists to map start station names to IDs and start station IDs to names
  start_name_to_ids <- split(dataframe$start_station_id, dataframe$start_station_name)
  start_id_to_names <- split(dataframe$start_station_name, dataframe$start_station_id)

  # Create lists to map end station names to IDs and end station IDs to names
  end_name_to_ids <- split(dataframe$end_station_id, dataframe$end_station_name)
  end_id_to_names <- split(dataframe$end_station_name, dataframe$end_station_id)

  # Check for mismatches in start stations (name to multiple IDs)
  cat("Start Station Names Mapping to Multiple IDs:\n")
  start_name_mismatches <- Filter(function(ids) length(unique(ids)) > 1, start_name_to_ids)
  if (length(start_name_mismatches) > 0) {
    for (name in names(start_name_mismatches)) {
      ids <- start_name_to_ids[[name]]
      cat(sprintf("%s: %s (Instances: %d)\n", name, paste(unique(ids), collapse = ", "), length(unique(ids))))
    }
  } else {
    cat("nil\n")
  }

  # Check for mismatches in start stations (ID to multiple names)
  cat("\nStart Station IDs Mapping to Multiple Names:\n")
  start_id_mismatches <- Filter(function(names) length(unique(names)) > 1, start_id_to_names)
  if (length(start_id_mismatches) > 0) {
    for (station_id in names(start_id_mismatches)) {
      names <- start_id_to_names[[station_id]]
      cat(sprintf("%s: %s (Instances: %d)\n", station_id, paste(unique(names), collapse = ", "), length(unique(names))))
    }
  } else {
    cat("nil\n")
  }

  # Check for mismatches in end stations (name to multiple IDs)
  cat("\nEnd Station Names Mapping to Multiple IDs:\n")
  end_name_mismatches <- Filter(function(ids) length(unique(ids)) > 1, end_name_to_ids)
  if (length(end_name_mismatches) > 0) {
    for (name in names(end_name_mismatches)) {
      ids <- end_name_to_ids[[name]]
      cat(sprintf("%s: %s (Instances: %d)\n", name, paste(unique(ids), collapse = ", "), length(unique(ids))))
    }
  } else {
    cat("nil\n")
  }

  # Check for mismatches in end stations (ID to multiple names)
  cat("\nEnd Station IDs Mapping to Multiple Names:\n")
  end_id_mismatches <- Filter(function(names) length(unique(names)) > 1, end_id_to_names)
  if (length(end_id_mismatches) > 0) {
    for (station_id in names(end_id_mismatches)) {
      names <- end_id_to_names[[station_id]]
      cat(sprintf("%s: %s (Instances: %d)\n", station_id, paste(unique(names), collapse = ", "), length(unique(names))))
    }
  } else {
    cat("nil\n")
  }
}

validate_station_mappings(combined_df)
```

```{r}
# Count trips starting at station ID "S32020"
start_S32020 <- sum(combined_df$start_station_id == "S32020")

# Count trips ending at station ID "S32020"
end_S32020 <- sum(combined_df$end_station_id == "S32020")

# Total trips starting or ending at S32020
S32020_mismatch <- start_S32020 + end_S32020
cat(sprintf("%d of the trips start or end at station S32020.\n", S32020_mismatch))

# Delete trips starting or ending at station ID "S32020"
combined_df <- combined_df[!(combined_df$start_station_id == "S32020" | 
                               combined_df$end_station_id == "S32020"), ]
```

```{r}
# Count instances of "A32046" under start and end station IDs for the name "Tremont St at Court St"
count_start <- sum(combined_df$start_station_id == "A32046" & 
                   combined_df$start_station_name == "Tremont St at Court St")

count_end <- sum(combined_df$end_station_id == "A32046" & 
                 combined_df$end_station_name == "Tremont St at Court St")

# Total instances
total_count <- count_start + count_end
cat(sprintf("Total instances of station ID A32046 mismatched with Tremont St at Court St: %d\n", total_count))

# Update start_station_name and end_station_name for "A32046" instances
# Station ID A32046 is for "Canal St at Causeway St" not "Tremont St at Court St"

combined_df$start_station_name[combined_df$start_station_id == "A32046" & 
                               combined_df$start_station_name == "Tremont St at Court St"] <- "Canal St at Causeway St"

combined_df$end_station_name[combined_df$end_station_id == "A32046" & 
                             combined_df$end_station_name == "Tremont St at Court St"] <- "Canal St at Causeway St"
```

```{r}
# Function to update station names in the data frame
update_station_names <- function(dataframe, old_name, new_name) {
  # Update both start and end station names
  dataframe$start_station_name[dataframe$start_station_name == old_name] <- new_name
  dataframe$end_station_name[dataframe$end_station_name == old_name] <- new_name
  return(dataframe)  # Return the modified data frame
}

# List of changes to be made
changes <- list(
  c("Canal St. at Causeway St.", "Canal St at Causeway St"),
  c("Tremont St. at Court St.", "Tremont St at Court St"),
  c("Chestnut Hill Ave. at Ledgemere Road", "Chestnut Hill Ave at Ledgemere Rd"),
  c("Centre St. at Allandale St.", "Centre St at Allandale St"),
  c("Hyde Square - Barbara St at Centre St", "Hyde Square - Centre St at Perkins St"),
  c("Swan Pl. at Minuteman Bikeway", "Swan Place at Minuteman Bikeway"),
  c("CambridgeSide Galleria - CambridgeSide PL at Land Blvd", "Cambridgeside Pl at Land Blvd"),
  c("Summer St at Quincy St", "Somerville Hospital"),
  c("Everett Square (Broadway at Chelsea St)", "Everett Square (Broadway at Norwood St)"),
  c("Damrell st at Old Colony Ave", "Damrell St at Old Colony Ave")
)

# Applying the changes to the data frame
for (change in changes) {
  combined_df <- update_station_names(combined_df, change[1], change[2])
}

# Confirmation message
cat("Station names updated successfully.\n")
```

```{r}
# Check for mismatch again
validate_station_mappings(combined_df)
```

```{r, fig.width=12, fig.height=5}
# Extract the hours the trips started
combined_df$start_hour <- lubridate::hour(combined_df$started_at)

# Group by Hour of Day to calculate total trips
hourly_trip_starts <- combined_df %>%
  group_by(start_hour) %>%
  summarise(Total_Start_Trips = n(), .groups = 'drop')

# Plotting
ggplot(hourly_trip_starts, aes(x = start_hour, y = Total_Start_Trips)) +
  geom_line(color = "blue", size = 1) + # Line plot
  geom_point(color = "blue", size = 3) + # Points on the line
  scale_x_continuous(breaks = 0:23) + # Set x-axis ticks to show every hour
  geom_vline(xintercept = 8, linetype = "dashed", color = "darkgreen", size = 1) + # Morning Peak Hour
  geom_vline(xintercept = 17, linetype = "dashed", color = "darkred", size = 1) + # Evening Peak Hour
  labs(title = "Total Trips by Hour of Day",
       x = "Hour of Day",
       y = "Total Trips") +
  theme_minimal() + # Clean theme
  theme(axis.line = element_line(color = "black"), # Show only the x and y axis lines
        panel.grid.major = element_line(color = "grey80"), # Introduce horizontal grid lines
        panel.grid.minor = element_blank(), # Remove minor grid lines
        plot.title = element_text(hjust = 0.5)) + # Center the title
  scale_y_continuous(labels = scales::comma) + # Format y-axis labels
  annotate("text", x = 8, y = max(hourly_trip_starts$Total_Start_Trips) * 0.9, 
           label = "Morning Peak Hour (08:00 A.M.)", color = "darkgreen") +
  annotate("text", x = 17, y = max(hourly_trip_starts$Total_Start_Trips) * 0.9, 
           label = "Evening Peak Hour (05:00 P.M.)", color = "darkred")
```

```{r, fig.width=10, fig.height=5}
# TOTAL TRIPS PER HOUR OF DAY AND DAY OF WEEK

# Extract the day of the week the trips started
combined_df$start_day_of_week <- lubridate::wday(combined_df$started_at, label = TRUE, abbr = FALSE)

# Extract the hours the trips started
combined_df$start_hour <- lubridate::hour(combined_df$started_at)

# Group by Day of the Week and Hour of Day to calculate total trips
hourly_weekly_trip_starts <- combined_df %>%
  group_by(start_day_of_week, start_hour) %>%
  summarise(Total_Trips = n(), .groups = 'drop') %>%
  pivot_wider(names_from = start_hour, values_from = Total_Trips, values_fill = list(Total_Trips = 0))

# Reorder the days of the week for proper visualization
days_order <- c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")
hourly_weekly_trip_starts$start_day_of_week <- factor(hourly_weekly_trip_starts$start_day_of_week, levels = days_order)

# Reshape the data to long format for ggplot
hourly_weekly_trip_long <- hourly_weekly_trip_starts %>%
  pivot_longer(cols = -start_day_of_week, names_to = "start_hour", values_to = "Total_Trips")

# Convert start_hour to numeric for plotting
hourly_weekly_trip_long$start_hour <- as.numeric(hourly_weekly_trip_long$start_hour)

ggplot(hourly_weekly_trip_long, aes(x = start_hour, y = Total_Trips, color = start_day_of_week)) +
  geom_line(size = 1) + # Line plot for each day
  geom_point(size = 2) + # Add markers to the plot
  scale_x_continuous(breaks = 0:23) + # Set x-axis ticks to show every hour
  scale_y_continuous(labels = scales::comma) +
  labs(title = "Daily Trips by Hour of Day and Day of Week",
       x = "Hour of Day",
       y = "Total Trips") +
  theme_minimal() + # Clean theme
  theme(axis.line = element_line(color = "black"), # Show only the x and y axis lines
        panel.grid.major = element_line(color = "lightgray"), # Add horizontal grid lines
        panel.grid.minor = element_blank(),
        plot.title = element_text(hjust = 0.5)) + # Center the title
  scale_color_manual(values = c("Monday" = "blue", 
                                 "Tuesday" = "orange", 
                                 "Wednesday" = "darkgreen", 
                                 "Thursday" = "purple", 
                                 "Friday" = "red", 
                                 "Saturday" = "brown", 
                                 "Sunday" = "black"),
                     name = "Day of Week") +
  guides(colour = guide_legend(override.aes = list(size = 1)))
```

```{r, fig.width=12, fig.height=4}
# TOTAL TRIPS PER HOUR OF DAY AND DAY OF WEEK (HEATMAP)

# Extract the day of the week the trips started
combined_df$start_day_of_week <- lubridate::wday(combined_df$started_at, label = TRUE, abbr = FALSE)

# Extract the hours the trips started
combined_df$start_hour <- lubridate::hour(combined_df$started_at)

# Group by Day of the Week and Hour of Day to calculate total trips
hourly_weekly_trip_starts <- combined_df %>%
  group_by(start_day_of_week, start_hour) %>%
  summarise(Total_Trips = n(), .groups = 'drop')

# Create the heat map
ggplot(hourly_weekly_trip_starts, aes(x = start_hour, y = start_day_of_week, fill = Total_Trips)) +
  geom_tile(color = "black", linewidth = 0.5) + # Heat map tiles with black borders
  scale_fill_gradient(low = "white", high = "red", name = "Total Trips") + # Red gradient
  labs(title = "Daily Trips by Hour of Day and Day of Week",
       x = "Hour of Day",
       y = "Day of Week") +
  theme_minimal() + # Clean theme
  theme(axis.line = element_blank(), # Remove axis lines
        panel.grid.major = element_blank(), # Remove grid lines
        plot.title = element_text(hjust = 0.5, size = 16), # Center and size title
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10))
```
```{r, fig.width=12, fig.height=4}
# TOTAL TRIPS PER HOUR OF DAY BY RIDER TYPE

# Extract the hours the trips started
combined_df$start_hour <- lubridate::hour(combined_df$started_at)

# Group by Hour of Day and Rider Type to calculate total trips
hourly_trip_starts_by_rider_type <- combined_df %>%
  group_by(start_hour, rider_type) %>%
  summarise(Total_Trips = n(), .groups = 'drop')

# Plotting
ggplot(hourly_trip_starts_by_rider_type, aes(x = start_hour, y = Total_Trips, color = rider_type)) +
  geom_line(size = 1) + # Line plot
  geom_point(size = 3) + # Points on the line
  scale_x_continuous(breaks = 0:23) + # Set x-axis ticks to show every hour
  scale_y_continuous(labels = scales::comma) +
  labs(title = "Total Trips by Hour of Day by Rider Type",
       x = "Hour of Day",
       y = "Total Trips") +
  theme_minimal() + # Clean theme
  theme(axis.line = element_line(color = "black"), # Show only the x and y axis lines
        panel.grid.major = element_line(color = "lightgray"), # Add horizontal grid lines
        panel.grid.minor = element_blank(),
        plot.title = element_text(hjust = 0.5)) + # Center the title
  scale_color_manual(values = c("member" = "blue", "casual" = "red"), name = "Rider Type") # Customize colors
```

```{r, fig.width=4, fig.height=4}
# RIDER TYPE ANALYSIS

# Group by Rider Type and Bike Type to calculate total trips
rider_type_analysis <- combined_df %>%
  group_by(rider_type, bike_type) %>%
  summarise(Total_Trips = n(), .groups = 'drop')

# Plotting
ggplot(rider_type_analysis, aes(x = rider_type, y = Total_Trips, fill = bike_type)) +
  geom_bar(stat = "identity", position = "stack") + # Stacked bar plot
  scale_y_continuous(labels = scales::comma) +
  labs(title = "Rider Type Analysis by Bike Type",
       x = "Rider Type",
       y = "Total Trips") +
  theme_minimal() + # Clean theme
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5), # Ensure x-axis labels are horizontal
        plot.title = element_text(hjust = 0.5)) + # Center the title
  scale_fill_brewer(palette = "Set1") # Automatically use a palette to map colors
```

```{r, fig.width=4, fig.height=4}
# Calculate trip duration in minutes
combined_df <- combined_df %>%
  mutate(trip_duration_minutes = as.numeric(difftime(ended_at, started_at, units = "mins")))

# Create the box plot
ggplot(combined_df, aes(x = bike_type, y = trip_duration_minutes)) +
  geom_boxplot() +
  labs(title = "Trip Duration by Bike Type",
       y = "Trip Duration (minutes)",
       x = "Bike Type") +
  theme_minimal() + # Clean theme
  theme(plot.title = element_text(hjust = 0.5)) + # Center the title
  scale_y_continuous(labels = scales::comma) # Format y-axis labels with commas
```

```{r, fig.width=4, fig.height=4}
# Calculate trip duration in minutes
combined_df <- combined_df %>%
  mutate(trip_duration_minutes = as.numeric(difftime(ended_at, started_at, units = "mins")))

# Calculate Q1, Q3, and IQR
Q1 <- quantile(combined_df$trip_duration_minutes, 0.25, na.rm = TRUE)
Q3 <- quantile(combined_df$trip_duration_minutes, 0.75, na.rm = TRUE)
IQR <- IQR(combined_df$trip_duration_minutes, na.rm = TRUE)

# Define outlier bounds
lower_bound <- Q1 - 1.5 * IQR
upper_bound <- Q3 + 1.5 * IQR

# Filter the dataframe to exclude outliers
filtered_df <- combined_df %>%
  filter(trip_duration_minutes >= lower_bound & trip_duration_minutes <= upper_bound)

# Create the boxplot without outliers
ggplot(filtered_df, aes(x = bike_type, y = trip_duration_minutes)) +
  geom_boxplot(outlier.shape = NA) + # Exclude outlier points
  labs(title = "Trip Duration by Bike Type (Without Outliers)",
       y = "Trip Duration (minutes)",
       x = "Bike Type") +
  theme_minimal() + # Clean theme
  theme(plot.title = element_text(hjust = 0.5)) # Center the title
```

```{r, fig.width=12, fig.height=4}
# Group by Hour of Day and Bike Type to calculate total trips
hourly_trip_starts_by_bike_type <- combined_df %>%
  group_by(start_hour, bike_type) %>%
  summarise(Total_Trips = n(), .groups = 'drop')

# Plotting
ggplot(hourly_trip_starts_by_bike_type, aes(x = start_hour, y = Total_Trips, color = bike_type)) +
  geom_line(size = 1) +  # Line plot
  geom_point(size = 3) +  # Points on the line
  scale_x_continuous(breaks = 0:23) +  # Set x-axis ticks to show every hour
  labs(title = "Total Trips by Hour of Day by Bike Type",
       x = "Hour of Day",
       y = "Total Trips") +
  scale_y_continuous(labels = scales::comma) +  # Format y-axis labels
  theme_minimal() +  # Clean theme
  theme(axis.line = element_line(color = "black"),  # Show only the x and y axis lines
        panel.grid.major = element_line(color = "lightgray"),  # Add horizontal grid lines
        panel.grid.minor = element_blank(),
        plot.title = element_text(hjust = 0.5)) +  # Center the title
  scale_color_manual(values = c("classic_bike" = "blue", "electric_bike" = "red"), name = "Bike Type")  # Customize colors
```

```{r, fig.width=7, fig.height=5}
# Extract the month the trips started
combined_df$start_month <- format(combined_df$started_at, "%B")

# Count total trips by month
monthly_trip_counts <- combined_df %>%
  group_by(start_month) %>%
  summarise(Total_Trips = n(), .groups = 'drop') %>%
  mutate(start_month = factor(start_month, levels = c("December", "January", "February", 
                                                       "March", "April", "May", 
                                                       "June", "July", "August", 
                                                       "September", "October", "November"))) %>%
  arrange(start_month)

# Create a time series plot for total trips by month
ggplot(monthly_trip_counts, aes(x = start_month, y = Total_Trips)) +
  geom_bar(stat = "identity", fill = "blue") +
  labs(title = "Total Trips by Month (from Dec 2023 to Nov 2024)",
       x = "Month",
       y = "Total Trips") +
  scale_y_continuous(breaks = seq(0, max(monthly_trip_counts$Total_Trips), by = 100000),  # Set y-axis breaks
                     labels = scales::comma) +  # Format y-axis labels
  theme_minimal() +  # Clean theme
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5),  # Ensure x-axis labels are horizontal
        plot.title = element_text(hjust = 0.5),  # Center the title
        panel.grid.major = element_line(color = "lightgray")) +  # Add horizontal grid lines
  geom_hline(yintercept = 0, color = "gray", linewidth = 0.8)  # Add a horizontal line at y=0
```
```{r}
# Display the first few rows of combined_df
head(combined_df)
```
```{r}
summary(combined_df$trip_duration_minutes)
```
```{r}
# Filter out negative durations and durations greater than 300 minutes
cleaned_trip_durations <- combined_df %>%
  filter(trip_duration_minutes > 0, trip_duration_minutes < 300)
```

```{r, fig.width=12, fig.height=4}
# Extract year and month from the start date
combined_df$start_year_month <- format(combined_df$started_at, "%Y-%m")

# Calculate the average trip duration by month
average_duration <- combined_df %>%
  group_by(start_year_month) %>%
  summarise(average_trip_duration = mean(trip_duration_minutes, na.rm = TRUE))

# Plotting the average trip duration over time
ggplot(average_duration, aes(x = start_year_month, y = average_trip_duration, group = 1)) +
  geom_line(color = "red", size = 1) +
  geom_point(color = "red", size = 3) +
  labs(title = "Average Trip Duration Over Time",
       x = "Month",
       y = "Average Duration (minutes)") +
  theme_minimal() +
  theme(axis.text.x = element_text(hjust = 1),
        plot.title = element_text(hjust = 0.5)) +
  scale_y_continuous(labels = scales::comma) + # Format y-axis labels
  scale_x_discrete(labels = function(x) format(as.Date(paste0(x, "-01")), "%b %Y")) # Format x-axis as Month Year
```

```{r, fig.width=12, fig.height=4}
# Create a density plot of the cleaned trip durations
ggplot(cleaned_trip_durations, aes(x = trip_duration_minutes)) +
  geom_density(fill = "red", color = "red", alpha = 0.7) +
  labs(title = "Density Plot of Trip Durations (Filtered)",
       x = "Trip Duration [minutes]",
       y = "Density") +
  theme_minimal() +  # Clean theme
  theme(plot.title = element_text(hjust = 0.5)) +  # Center the title
  scale_y_continuous(labels = scales::comma) +  # Format y-axis with comma separators
  geom_hline(yintercept = 0, color = "red", linewidth = 0.8)  # Add a horizontal line at y=0
```

```{r}
# Define a function to get the season based on the month
get_season <- function(month) {
  if (month %in% c(12, 1, 2)) {
    return('Winter')
  } else if (month %in% c(3, 4, 5)) {
    return('Spring')
  } else if (month %in% c(6, 7, 8)) {
    return('Summer')
  } else {
    return('Fall')
  }
}

# Apply the function to get the season for each trip
combined_df$season <- sapply(format(combined_df$started_at, "%m"), function(month) get_season(as.numeric(month)))

# Count the number of trips by season
seasonal_trips <- combined_df %>%
  group_by(season) %>%
  summarise(Total_Trips = n(), .groups = 'drop')

# Plotting
ggplot(seasonal_trips, aes(x = season, y = Total_Trips, fill = season)) +
  geom_bar(stat = "identity", color = "black") +
  scale_fill_manual(values = c("Winter" = "blue", "Spring" = "springgreen", "Summer" = "orange", "Fall" = "red")) +
  labs(title = "Number of Trips by Season",
       x = "Season",
       y = "Number of Trips") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 0, hjust = 0.5)) +
  geom_hline(yintercept = 0, color = "gray", linewidth = 0.8) +  # Add horizontal line at y=0
  scale_y_continuous(labels = scales::comma)
```
```{r}
# Filter the trip durations for electric and classic bikes
electric_durations <- combined_df[combined_df$bike_type == "electric_bike", "trip_duration_minutes"]
classic_durations <- combined_df[combined_df$bike_type == "classic_bike", "trip_duration_minutes"]

# Perform independent t-test
t_test_result <- t.test(electric_durations, classic_durations)

# Output the result
print(t_test_result)
```











